= SPEC-1: Система управління шпигунськими котами
:sectnums:
:toc:

== Background

Spy Cat Agency (SCA) спеціалізується на шпигунській діяльності за допомогою спеціально навчених котів. Агентство регулярно виконує місії, які включають стеження за цілями та збір даних. Коти можуть взаємодіяти із системою, додаючи нотатки про цілі, а агентство — призначати котів для виконання місій і відстежувати їхній прогрес.

Мета: створити CRUD-додаток для управління шпигунськими котами, їхніми місіями і цілями. Система має бути побудована з використанням Django як фреймворку та PostgreSQL як бази даних.

== Requirements

Система управління шпигунськими котами повинна виконувати наступні функції:

=== Must Have
1. CRUD-функціонал для котів:
   - Створення, оновлення (зарплата), видалення, перегляд котів.
   - Валідація породи кота через TheCatAPI.

2. CRUD-функціонал для місій:
   - Створення місій з прив’язаними цілями в одному запиті.
   - Видалення місій (якщо не призначені коту).
   - Призначення місії коту.
   - Оновлення стану цілей (включно з завершенням).

3. Управління нотатками для цілей:
   - Додавання та оновлення нотаток.
   - Заборона редагування нотаток для завершених цілей.

4. Відображення списків і окремих записів:
   - Список котів, місій.
   - Деталізація кожного кота чи місії.

5. База даних PostgreSQL для збереження даних.

6. RESTful API з валідацією вхідних даних і статусами відповіді.

=== Should Have
1. Документація API (наприклад, через OpenAPI).
2. Колекція Postman із прикладами запитів.

=== Could Have
1. Логування дій у системі (створення/зміни записів).
2. Обмеження ролей (адмін/користувач).

=== Won't Have
1. Окремий інтерфейс для створення/перегляду списку цілей.
2. Інтеграція сторонніх баз даних або API, окрім TheCatAPI.

== Cats
-----
id (PK)
name (VARCHAR)
years_of_experience (INT)
breed (VARCHAR)
salary (DECIMAL)
-----

Missions
-----
id (PK)
cat_id (FK to Cats, nullable)
is_completed (BOOLEAN)
-----

Targets
-----
id (PK)
mission_id (FK to Missions)
name (VARCHAR)
country (VARCHAR)
notes (TEXT)
is_completed (BOOLEAN)
-----

== Method

Система побудована на основі Django REST Framework (DRF) з використанням PostgreSQL як бази даних. Основні компоненти та їх реалізація описані нижче.

=== Архітектура

[plantuml]
----
@startuml
package "Backend (Django)" {
    component "API: Cats" as CatsAPI
    component "API: Missions" as MissionsAPI
    component "API: Targets" as TargetsAPI
    component "Service: TheCatAPI" as TheCatAPI
}

database "PostgreSQL" as DB {
    entity "Cats" {
        * id : PK
        --
        name : VARCHAR
        years_of_experience : INT
        breed : VARCHAR
        salary : DECIMAL
    }

    entity "Missions" {
        * id : PK
        --
        cat_id : FK (Cats)
        is_completed : BOOLEAN
    }

    entity "Targets" {
        * id : PK
        --
        mission_id : FK (Missions)
        name : VARCHAR
        country : VARCHAR
        notes : TEXT
        is_completed : BOOLEAN
    }
}

CatsAPI --> DB : CRUD Operations
MissionsAPI --> DB : CRUD Operations
TargetsAPI --> DB : CRUD Operations
CatsAPI --> TheCatAPI : Validate Breed
@enduml
----

=== Схема бази даних

1. **Cats**:
    - `id` (PK): Унікальний ідентифікатор кота.
    - `name`: Ім’я кота (текст).
    - `years_of_experience`: Роки досвіду.
    - `breed`: Порода (перевіряється через TheCatAPI).
    - `salary`: Зарплата кота.

2. **Missions**:
    - `id` (PK): Унікальний ідентифікатор місії.
    - `cat_id` (FK): Ідентифікатор кота (nullable, лише якщо місія ще не призначена).
    - `is_completed`: Статус завершення місії.

3. **Targets**:
    - `id` (PK): Унікальний ідентифікатор цілі.
    - `mission_id` (FK): Ідентифікатор місії.
    - `name`: Назва цілі.
    - `country`: Країна цілі.
    - `notes`: Нотатки кота (текст).
    - `is_completed`: Статус завершення цілі.

=== API Ендпоінти

1. **Коти**:
    - **GET /cats/**: Повертає список котів.
    - **POST /cats/**: Додає кота з валідацією породи.
    - **GET /cats/{id}/**: Повертає дані конкретного кота.
    - **PATCH /cats/{id}/**: Оновлює зарплату кота.
    - **DELETE /cats/{id}/**: Видаляє кота.

2. **Місії**:
    - **GET /missions/**: Повертає список місій.
    - **POST /missions/**: Створює місію та її цілі.
    - **GET /missions/{id}/**: Повертає деталі місії.
    - **PATCH /missions/{id}/assign/**: Призначає місію коту.
    - **DELETE /missions/{id}/**: Видаляє місію, якщо вона не призначена.

3. **Цілі**:
    - **PATCH /targets/{id}/notes/**: Оновлює нотатки для цілі (якщо не завершена).
    - **PATCH /targets/{id}/complete/**: Позначає ціль як завершену.

=== Інтеграція з TheCatAPI

Для перевірки породи кота використовується API [TheCatAPI](https://api.thecatapi.com/v1/breeds). Запит виконується під час створення чи оновлення кота:
- Якщо порода не знайдена у списку порід TheCatAPI, повертається помилка 400.

== Implementation

=== Кроки реалізації

1. **Налаштування середовища**
    - Встановити `Django` та `Django REST Framework`.
    - Налаштувати PostgreSQL:
        - Створити базу даних `spy_cat_agency`.
        - Налаштувати підключення в `settings.py`.
    - Встановити бібліотеку для роботи з TheCatAPI (наприклад, `requests`).

2. **Створення додатку Django**
    - Створити додаток `cats` для управління котами.
    - Створити додаток `missions` для місій і цілей.

3. **Моделі бази даних**
    - Визначити моделі `Cat`, `Mission`, `Target` згідно зі схемою.
    - Налаштувати зв’язки між моделями через `ForeignKey`.
    - Виконати міграції для створення таблиць у базі даних.

4. **Реалізація логіки API**
    - Налаштувати серіалізатори (`Serializers`) для валідації та перетворення даних.
    - Створити в’юшки (`Views`) для обробки запитів:
        - Коти: CRUD-операції з інтеграцією TheCatAPI.
        - Місії: Створення, призначення, видалення місій.
        - Цілі: Оновлення нотаток і статусів.
    - Налаштувати маршрутизацію (`urls.py`).

5. **Інтеграція з TheCatAPI**
    - Реалізувати сервісний клас для перевірки породи кота:
        - Надсилати запит до `/v1/breeds`.
        - Перевіряти наявність породи у відповіді.

6. **Тестування**
    - Створити тестові дані в базі.
    - Перевірити коректність роботи ендпоінтів через Postman:
        - CRUD для котів.
        - Створення місій із цілями.
        - Призначення місій котам.
        - Оновлення нотаток і статусів.

7. **Документація**
    - Налаштувати автоматичну генерацію документації API через OpenAPI/Swagger.
    - Створити колекцію Postman для тестування ендпоінтів.
    - Написати README із детальними інструкціями.

8. **Завантаження проекту**
    - Завантажити код у репозиторій GitHub.
    - Переконатися, що вказані всі залежності у `requirements.txt`.

== Milestones

=== Етап 1: Налаштування середовища (1 день)
- Встановлення Django, Django REST Framework.
- Налаштування PostgreSQL та створення бази даних `spy_cat_agency`.
- Ініціалізація проекту Django та додатків `cats` і `missions`.

=== Етап 2: Розробка базової моделі (2 дні)
- Створення моделей `Cat`, `Mission`, `Target` згідно зі схемою бази даних.
- Налаштування міграцій і створення таблиць у базі даних.
- Реалізація зв’язків між таблицями (FK).

=== Етап 3: Розробка API для котів (2 дні)
- CRUD-функціонал для котів:
  - Серіалізатори, в’юшки та маршрути.
  - Інтеграція з TheCatAPI для валідації породи.
- Тестування API через Postman.

=== Етап 4: Розробка API для місій і цілей (3 дні)
- CRUD-функціонал для місій і цілей:
  - Створення місій із цілями в одному запиті.
  - Призначення місій котам.
  - Оновлення нотаток і статусів цілей.
- Реалізація обмежень (неможливість редагувати завершені цілі).

=== Етап 5: Тестування і документація (2 дні)
- Створення тестових сценаріїв і перевірка коректності API.
- Налаштування документації OpenAPI/Swagger.
- Створення колекції Postman для демонстрації роботи API.

=== Етап 6: Завантаження проекту (0.5 дня)
- Завантаження коду в репозиторій GitHub.
- Написання README з інструкціями для запуску.
- Перевірка залежностей у `requirements.txt`.

== Gathering Results

Для оцінки успішності впровадження системи будуть виконані наступні дії:

1. **Перевірка функціональності API**:
    - Використання колекції Postman для тестування:
        - CRUD для котів і місій.
        - Призначення котів на місії.
        - Оновлення нотаток та завершення цілей.
    - Переконатися, що всі ендпоінти повертають відповідні статуси (200, 201, 400, 404 тощо).

2. **Перевірка бізнес-логіки**:
    - Забезпечення, що:
        - Один кіт може мати лише одну активну місію.
        - Нотатки не можна редагувати для завершених цілей.
        - Місії не можна видалити, якщо вони призначені коту.

3. **Перевірка інтеграції з TheCatAPI**:
    - Переконатися, що валідація породи працює коректно, і помилкові запити повертають статус 400.

4. **Продуктивність та стабільність**:
    - Запустити тестовий сервер і перевірити стабільність роботи системи під навантаженням (до 50 одночасних запитів).
    - Переконатися, що час відповіді API не перевищує 200 мс для стандартних запитів.

5. **Оцінка коду**:
    - Перегляд коду на предмет:
        - Ясності структури та стилю.
        - Наявності необхідних коментарів.
        - Відповідності принципам RESTful API.

6. **Зворотний зв'язок**:
    - Отримання зворотного зв’язку від команди рекрутерів.
    - Внесення покращень на основі отриманих рекомендацій.
